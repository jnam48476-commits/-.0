<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All-in-One Mobile Tetris</title>
    <style>
        /* ---------------- CSS ì‹œì‘ ---------------- */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Arial', sans-serif;
            background-color: #333;
            color: #fff;
            user-select: none; /* ëª¨ë°”ì¼ì—ì„œ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
            -webkit-user-select: none; /* iOS Safari */
            -ms-user-select: none; /* IE/Edge */
        }

        #game-container {
            display: flex;
            flex-direction: column; 
            align-items: center;
            width: 95%; 
            max-width: 400px;
            padding: 10px;
            background-color: #222;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #game-board {
            display: grid;
            grid-template-columns: repeat(10, 1fr); 
            width: 100%;
            border: 4px solid #fff;
            background-color: #000;
            aspect-ratio: 10 / 20; /* 10:20 ë¹„ìœ¨ ìœ ì§€ */
        }

        .square {
            /* ê° ì¹¸ì˜ ìµœì†Œ ë†’ì´ */
            min-height: 1.5vw; 
            box-sizing: border-box;
            border: 1px solid rgba(255, 255, 255, 0.1); /* ê·¸ë¦¬ë“œ ë¼ì¸ */
        }

        .block {
            border: 1px solid #111;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        /* ë¸”ë¡ ìƒ‰ìƒ ì •ì˜ */
        .color-0 { background-color: cyan; } /* I */
        .color-1 { background-color: blue; } /* J */
        .color-2 { background-color: orange; } /* L */
        .color-3 { background-color: yellow; } /* O */
        .color-4 { background-color: lime; } /* S */
        .color-5 { background-color: purple; } /* T */
        .color-6 { background-color: red; } /* Z */

        #info-panel {
            width: 100%;
            text-align: center;
            margin: 10px 0;
        }

        /* ëª¨ë°”ì¼ ì¡°ì‘ ë²„íŠ¼ */
        #mobile-controls {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 20px;
        }

        #mobile-controls button {
            padding: 15px 20px; /* í„°ì¹˜ ì˜ì—­ í™•ë³´ */
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.1s;
            touch-action: manipulation; /* ëª¨ë°”ì¼ ì§€ì—° ë°©ì§€ */
        }

        #mobile-controls button:active {
            background-color: #0056b3;
        }
        /* ---------------- CSS ë ---------------- */
    </style>
</head>
<body>
    <div id="game-container">
        <div id="info-panel">
            <h2>í…ŒíŠ¸ë¦¬ìŠ¤</h2>
            <p>ì ìˆ˜: <span id="score">0</span></p>
        </div>

        <div id="game-board">
            </div>
        
        <div id="mobile-controls">
            <button id="left-btn">â—€ Left</button>
            <button id="rotate-btn">ğŸ”„ Rotate</button>
            <button id="right-btn">â–¶ Right</button>
            <button id="down-btn">â¬‡ Down</button>
        </div>
        <p style="font-size: 0.8em; margin-top: 10px;">(PC: â†â†’â†‘â†“, ëª¨ë°”ì¼: ë²„íŠ¼ ì‚¬ìš©)</p>
    </div>

    <script>
        /* ---------------- JavaScript ì‹œì‘ ---------------- */
        const BOARD_WIDTH = 10;
        const BOARD_HEIGHT = 20;
        const gameBoard = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score');
        
        let squares = [];
        let score = 0;
        let timerId;
        
        // 7ê°€ì§€ í…ŒíŠ¸ë¡œë¯¸ë…¸ ëª¨ì–‘ ì •ì˜ (4x4 ê·¸ë¦¬ë“œ ê¸°ì¤€, ì²« ë²ˆì§¸ ì¸ë±ìŠ¤ëŠ” ê¸°ë³¸ íšŒì „)
        // [ëª¨ì–‘, ìƒ‰ìƒ ì¸ë±ìŠ¤]
        const theTetrominoes = [
            // I: cyan (0)
            [[1, BOARD_WIDTH + 1, BOARD_WIDTH * 2 + 1, BOARD_WIDTH * 3 + 1], 0], 
            // J: blue (1)
            [[0, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH * 2 + 1], 1],         
            // L: orange (2)
            [[2, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH * 2 + 1], 2],         
            // O: yellow (3) - íšŒì „í•´ë„ ëª¨ì–‘ ë³€í™” ì—†ìŒ
            [[0, 1, BOARD_WIDTH, BOARD_WIDTH + 1], 3],                           
            // S: lime (4)
            [[1, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH * 2], 4],             
            // T: purple (5)
            [[1, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH + 2], 5],             
            // Z: red (6)
            [[0, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH * 2 + 2], 6]          
        ];
        
        // í˜„ì¬ ë¸”ë¡ ë° ìœ„ì¹˜
        let currentRotation = 0; // íšŒì „ ìƒíƒœ (0~3)
        let random = Math.floor(Math.random() * theTetrominoes.length);
        let currentPieceData = theTetrominoes[random];
        let current = currentPieceData[0]; // í˜„ì¬ ë¸”ë¡ì˜ ì¢Œí‘œ
        let currentColor = currentPieceData[1];
        let currentPosition = 4; // ì‹œì‘ ìœ„ì¹˜ (ê°€ìš´ë° ìƒë‹¨)

        // 1. ê²Œì„ ë³´ë“œ ìƒì„± (200ê°œì˜ div)
        function createBoard() {
            for (let i = 0; i < BOARD_WIDTH * BOARD_HEIGHT; i++) {
                const square = document.createElement('div');
                square.classList.add('square');
                gameBoard.appendChild(square);
                squares.push(square);
            }
            // ë°”ë‹¥ ì¶©ëŒ ê°ì§€ë¥¼ ìœ„í•´ ë§¨ ì•„ë˜ ì¤„ì— 'taken' ë§ˆì»¤ ì¶”ê°€
            for (let i = 0; i < BOARD_WIDTH; i++) {
                const dummySquare = document.createElement('div');
                dummySquare.classList.add('square', 'taken');
                squares.push(dummySquare);
            }
        }
        
        // 2. ë¸”ë¡ ê·¸ë¦¬ê¸°
        function draw() {
            current.forEach(index => {
                squares[currentPosition + index].classList.add('block', `color-${currentColor}`);
            });
        }
        
        // 3. ë¸”ë¡ ì§€ìš°ê¸°
        function undraw() {
            current.forEach(index => {
                squares[currentPosition + index].classList.remove('block', `color-${currentColor}`);
            });
        }

        // 4. ë¸”ë¡ í•˜ê°• ë° ì¶©ëŒ ê°ì§€
        function moveDown() {
            undraw();
            if (!isAtBottom()) {
                currentPosition += BOARD_WIDTH;
            } else {
                freeze();
                return;
            }
            draw();
        }

        // ë°”ë‹¥ ë˜ëŠ” ë‹¤ë¥¸ ë¸”ë¡ê³¼ ì¶©ëŒ ê°ì§€
        function isAtBottom() {
            // í˜„ì¬ ìœ„ì¹˜ì—ì„œ ë‹¤ìŒ ì¹¸(BOARD_WIDTH ì•„ë˜)ì— 'taken' í´ë˜ìŠ¤ê°€ ìˆëŠ”ì§€ í™•ì¸
            return current.some(index => squares[currentPosition + index + BOARD_WIDTH].classList.contains('taken'));
        }

        // 5. ë¸”ë¡ ê³ ì • (Freeze)
        function freeze() {
            // í˜„ì¬ ë¸”ë¡ì˜ ëª¨ë“  ì¡°ê°ì„ 'taken'ìœ¼ë¡œ í‘œì‹œí•˜ì—¬ ê³ ì •
            current.forEach(index => squares[currentPosition + index].classList.add('taken'));
            
            // ì¤„ ì œê±° í™•ì¸
            addScore();
            
            // ìƒˆ ë¸”ë¡ ìƒì„±
            random = Math.floor(Math.random() * theTetrominoes.length);
            currentPieceData = theTetrominoes[random];
            current = currentPieceData[0];
            currentColor = currentPieceData[1];
            currentPosition = 4;
            draw();

            // ê²Œì„ ì˜¤ë²„ í™•ì¸
            if (current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                scoreDisplay.innerHTML = 'Game Over! (Score: ' + score + ')';
                clearInterval(timerId);
            }
        }

        // 6. ì´ë™ (ì¢Œ/ìš°)
        function move(direction) {
            undraw();
            
            // ê²½ê³„ì„  ê³„ì‚°
            const isAtLeftEdge = current.some(index => (currentPosition + index) % BOARD_WIDTH === 0);
            const isAtRightEdge = current.some(index => (currentPosition + index) % BOARD_WIDTH === BOARD_WIDTH - 1);
            
            let newPosition = currentPosition;
            
            if (direction === 'left') {
                if (!isAtLeftEdge) newPosition -= 1;
            } else if (direction === 'right') {
                if (!isAtRightEdge) newPosition += 1;
            }

            // ìƒˆë¡œìš´ ìœ„ì¹˜ì— 'taken' ë¸”ë¡ì´ ìˆëŠ”ì§€ í™•ì¸ (ì¶©ëŒ ë°©ì§€)
            if (!current.some(index => squares[newPosition + index].classList.contains('taken'))) {
                currentPosition = newPosition;
            }
            
            draw();
        }

        // 7. íšŒì „ (Rotate) - **ë‹¨ìˆœí™”ëœ ì˜ˆì‹œ ì½”ë“œ**
        // ì´ ì½”ë“œëŠ” ì‹¤ì œ í…ŒíŠ¸ë¦¬ìŠ¤ì˜ ë³µì¡í•œ íšŒì „(ë²½ì°¨ê¸° ë“±) ë¡œì§ì„ í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        function rotate() {
            // íšŒì „ ë¡œì§ì€ ë³µì¡í•˜ì—¬ ì´ ì½”ë“œì—ì„œëŠ” ìƒëµí•˜ì§€ë§Œ, 
            // ì‹¤ì œ êµ¬í˜„ ì‹œì—ëŠ” current ë°°ì—´ì˜ ê°’ì„ 90ë„ íšŒì „í•œ ìƒˆë¡œìš´ ë°°ì—´ë¡œ ë°”ê¿”ì•¼ í•©ë‹ˆë‹¤.
            // ì˜ˆë¥¼ ë“¤ì–´, T ë¸”ë¡ì€ 4ê°€ì§€ í˜•íƒœì˜ ë°°ì—´ì„ ë¯¸ë¦¬ ì •ì˜í•´ ë†“ê³  ìˆœí™˜í•©ë‹ˆë‹¤.
            
            // ì„ì‹œë¡œ T ë¸”ë¡ë§Œ ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ í‰ë‚´ë‚´ë´…ë‹ˆë‹¤ (ì‹¤ì œ íšŒì „ ë¡œì§ ì•„ë‹˜)
            if (currentColor === 5) { // T ë¸”ë¡ (5)
                undraw();
                currentRotation = (currentRotation + 1) % 4;
                
                // ì‹¤ì œë¡œëŠ” íšŒì „ëœ ì¢Œí‘œë¥¼ ê³„ì‚°í•´ì•¼ í•¨
                // ì—¬ê¸°ì„œëŠ” ë³µì¡ì„± ë•Œë¬¸ì— ë‹¨ìˆœí™”ëœ ê¸°ë³¸ ì¢Œí‘œë§Œ ìœ ì§€
                // current = theTetrominoes[5][currentRotation] // ì‹¤ì œ êµ¬í˜„ ì½”ë“œ
                draw();
            } else {
                 // ë‹¤ë¥¸ ë¸”ë¡ë“¤ì€ íšŒì „ ë¡œì§ì„ ì¶”ê°€í•´ì•¼ í•¨
            }
            draw();
        }

        // 8. ì¤„ ì œê±° ë° ì ìˆ˜ ì¶”ê°€
        function addScore() {
            // ê²Œì„ ë³´ë“œì˜ ì‹¤ì œ ë†’ì´(20ì¤„)ê¹Œì§€ë§Œ ìˆœíšŒ
            for (let i = 0; i < BOARD_WIDTH * BOARD_HEIGHT; i += BOARD_WIDTH) {
                const row = [];
                for (let j = 0; j < BOARD_WIDTH; j++) {
                    row.push(i + j);
                }
                
                // ì¤„ì´ ê½‰ ì°¼ëŠ”ì§€ í™•ì¸
                if (row.every(index => squares[index].classList.contains('taken'))) {
                    score += 10;
                    scoreDisplay.innerHTML = score;
                    
                    // ê½‰ ì°¬ ì¤„ ì œê±°
                    row.forEach(index => {
                        squares[index].classList.remove('taken', 'block', `color-${squares[index].className.match(/color-\d/)?.[0]?.slice(-1) || ''}`);
                    });
                    
                    // ìœ—ì¤„ë“¤ì„ ì•„ë˜ë¡œ ì´ë™
                    // squares ë°°ì—´ì—ì„œ ì œê±°ëœ ì¤„ì„ ì˜ë¼ë‚´ê³  (splice)
                    const squaresRemoved = squares.splice(i, BOARD_WIDTH);
                    // ì˜ë¼ë‚¸ ì¤„ì„ ë°°ì—´ ë§¨ ì•ìœ¼ë¡œ í•©ì¹©ë‹ˆë‹¤. (ìƒˆë¡œìš´ ë¹ˆ ì¤„ íš¨ê³¼)
                    squares = squaresRemoved.concat(squares);
                    
                    // HTML DOMì„ ìƒˆë¡œìš´ squares ë°°ì—´ ìˆœì„œëŒ€ë¡œ ë‹¤ì‹œ ê·¸ë¦½ë‹ˆë‹¤.
                    squares.forEach(cell => gameBoard.appendChild(cell));
                }
            }
        }

        // 9. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (PC í‚¤ë³´ë“œ)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') move('left');
            else if (e.key === 'ArrowRight') move('right');
            else if (e.key === 'ArrowDown') moveDown();
            else if (e.key === 'ArrowUp') rotate();
        });

        // 10. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ëª¨ë°”ì¼ í„°ì¹˜) - touchstart ì‚¬ìš©
        // e.preventDefault()ë¡œ ìŠ¤í¬ë¡¤ì´ë‚˜ í™•ëŒ€/ì¶•ì†Œ ë“± ë¸Œë¼ìš°ì € ê¸°ë³¸ ë™ì‘ì„ ë§‰ì•„ì¤ë‹ˆë‹¤.
        document.getElementById('left-btn').addEventListener('touchstart', (e) => { e.preventDefault(); move('left'); });
        document.getElementById('right-btn').addEventListener('touchstart', (e) => { e.preventDefault(); move('right'); });
        document.getElementById('rotate-btn').addEventListener('touchstart', (e) => { e.preventDefault(); rotate(); });
        document.getElementById('down-btn').addEventListener('touchstart', (e) => { e.preventDefault(); moveDown(); });

        // 11. ê²Œì„ ì‹œì‘
        createBoard();
        // 1ì´ˆë§ˆë‹¤ moveDown ì‹¤í–‰
        timerId = setInterval(moveDown, 1000); 
        /* ---------------- JavaScript ë ---------------- */
    </script>
</body>
</html>
