<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All-in-One Mobile Tetris</title>
    <style>
        /* ---------------- CSS ì‹œì‘ ---------------- */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Arial', sans-serif;
            background-color: #333;
            color: #fff;
            user-select: none; /* ëª¨ë°”ì¼ì—ì„œ í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
        }

        #game-container {
            display: flex;
            flex-direction: column; 
            align-items: center;
            width: 95%; 
            max-width: 400px;
            padding: 10px;
            background-color: #222;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #game-board {
            display: grid;
            /* JSì—ì„œ ì„¤ì •í•  ì˜ˆì •ì´ì§€ë§Œ, ê¸°ë³¸ í‹€ì„ ìœ„í•´ 10ì¹¸ */
            grid-template-columns: repeat(10, 1fr); 
            width: 100%;
            border: 4px solid #fff;
            background-color: #000;
            aspect-ratio: 10 / 20; /* 10:20 ë¹„ìœ¨ ìœ ì§€ */
        }

        .square {
            /* ê° ì¹¸ì˜ ìµœì†Œ ë†’ì´ */
            min-height: 1.5vw; 
            box-sizing: border-box;
            border: 1px solid rgba(255, 255, 255, 0.1); /* ê·¸ë¦¬ë“œ ë¼ì¸ */
        }

        .block {
            border: 1px solid #111;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        /* ë¸”ë¡ ìƒ‰ìƒ ì •ì˜ (JSì—ì„œ ì´ í´ë˜ìŠ¤ë“¤ì„ ì‚¬ìš©) */
        .color-0 { background-color: cyan; } /* I */
        .color-1 { background-color: blue; } /* J */
        .color-2 { background-color: orange; } /* L */
        .color-3 { background-color: yellow; } /* O */
        .color-4 { background-color: lime; } /* S */
        .color-5 { background-color: purple; } /* T */
        .color-6 { background-color: red; } /* Z */

        #info-panel {
            width: 100%;
            text-align: center;
            margin: 10px 0;
        }

        /* ëª¨ë°”ì¼ ì¡°ì‘ ë²„íŠ¼ */
        #mobile-controls {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 20px;
        }

        #mobile-controls button {
            padding: 15px 20px; 
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.1s;
            touch-action: manipulation; /* ëª¨ë°”ì¼ ì§€ì—° ë°©ì§€ */
        }

        #mobile-controls button:active {
            background-color: #0056b3;
        }
        /* ---------------- CSS ë ---------------- */
    </style>
</head>
<body>
    <div id="game-container">
        <div id="info-panel">
            <h2>í…ŒíŠ¸ë¦¬ìŠ¤</h2>
            <p>ì ìˆ˜: <span id="score">0</span></p>
        </div>

        <div id="game-board">
            </div>
        
        <div id="mobile-controls">
            <button id="left-btn">â—€ Left</button>
            <button id="rotate-btn">ğŸ”„ Rotate</button>
            <button id="right-btn">â–¶ Right</button>
            <button id="down-btn">â¬‡ Down</button>
        </div>
        <p style="font-size: 0.8em; margin-top: 10px;">(PC: â†â†’â†‘â†“, ëª¨ë°”ì¼: ë²„íŠ¼ ì‚¬ìš©)</p>
    </div>

    <script>
        /* ---------------- JavaScript ì‹œì‘ ---------------- */
        const BOARD_WIDTH = 10;
        const BOARD_HEIGHT = 20;
        const gameBoard = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score');
        
        let squares = [];
        let score = 0;
        let timerId;
        
        // 7ê°€ì§€ í…ŒíŠ¸ë¡œë¯¸ë…¸ ëª¨ì–‘ ì •ì˜ (4x4 ê·¸ë¦¬ë“œ ê¸°ì¤€)
        const theTetrominoes = [
            [[1, BOARD_WIDTH + 1, BOARD_WIDTH * 2 + 1, BOARD_WIDTH * 3 + 1], 0], // I
            [[0, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH * 2 + 1], 1],         // J
            [[2, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH * 2 + 1], 2],         // L
            [[0, 1, BOARD_WIDTH, BOARD_WIDTH + 1], 3],                           // O
            [[1, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH * 2], 4],             // S
            [[1, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH + 2], 5],             // T
            [[0, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH * 2 + 2], 6]          // Z (ì˜¤ë¥˜ ìˆ˜ì •: Zì ëª¨ì–‘)
        ];
        
        // í˜„ì¬ ë¸”ë¡ ë° ìœ„ì¹˜
        let currentPosition = 4;
        let random = Math.floor(Math.random() * theTetrominoes.length);
        let current = theTetrominoes[random][0];
        let currentColor = theTetrominoes[random][1];

        // 1. ê²Œì„ ë³´ë“œ ìƒì„± (200ê°œì˜ div)
        function createBoard() {
            for (let i = 0; i < BOARD_WIDTH * BOARD_HEIGHT; i++) {
                const square = document.createElement('div');
                square.classList.add('square');
                gameBoard.appendChild(square);
                squares.push(square);
            }
        }
        
        // 2. ë¸”ë¡ ê·¸ë¦¬ê¸°
        function draw() {
            current.forEach(index => {
                squares[currentPosition + index].classList.add('block', `color-${currentColor}`);
            });
        }
        
        // 3. ë¸”ë¡ ì§€ìš°ê¸°
        function undraw() {
            current.forEach(index => {
                squares[currentPosition + index].classList.remove('block', `color-${currentColor}`);
            });
        }

        // 4. ë¸”ë¡ í•˜ê°• ë° ì¶©ëŒ ê°ì§€
        function moveDown() {
            undraw();
            if (!isAtBottom()) {
                currentPosition += BOARD_WIDTH;
            } else {
                freeze();
                return;
            }
            draw();
        }

        // ë°”ë‹¥ ë˜ëŠ” ë‹¤ë¥¸ ë¸”ë¡ê³¼ ì¶©ëŒ ê°ì§€
        function isAtBottom() {
            return current.some(index => squares[currentPosition + index + BOARD_WIDTH].classList.contains('taken'));
        }

        // 5. ë¸”ë¡ ê³ ì • (Freeze)
        function freeze() {
            // í˜„ì¬ ë¸”ë¡ì˜ ëª¨ë“  ì¡°ê°ì„ 'taken'ìœ¼ë¡œ í‘œì‹œí•˜ì—¬ ê³ ì •
            current.forEach(index => squares[currentPosition + index].classList.add('taken'));
            
            // ì¤„ ì œê±° í™•ì¸
            addScore();
            
            // ìƒˆ ë¸”ë¡ ìƒì„±
            random = Math.floor(Math.random() * theTetrominoes.length);
            current = theTetrominoes[random][0];
            currentColor = theTetrominoes[random][1];
            currentPosition = 4;
            draw();

            // ê²Œì„ ì˜¤ë²„ í™•ì¸ (ìƒˆ ë¸”ë¡ì´ ìƒì„±ë˜ìë§ˆì ì¶©ëŒí•˜ë©´ ê²Œì„ ì˜¤ë²„)
            if (current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                scoreDisplay.innerHTML = 'Game Over!';
                clearInterval(timerId);
            }
        }

        // 6. ì´ë™ (ì¢Œ/ìš°)
        function move(direction) {
            undraw();
            const isAtLeftEdge = current.some(index => (currentPosition + index) % BOARD_WIDTH === 0);
            const isAtRightEdge = current.some(index => (currentPosition + index) % BOARD_WIDTH === BOARD_WIDTH - 1);
            
            // ê²½ê³„ë‚˜ ì´ë¯¸ ê³ ì •ëœ ë¸”ë¡ê³¼ ì¶©ëŒí•˜ë©´ ì´ë™ ì•ˆ í•¨
            if (direction === 'left' && !isAtLeftEdge && !current.some(index => squares[currentPosition + index - 1].classList.contains('taken'))) {
                currentPosition -= 1;
            }
            if (direction === 'right' && !isAtRightEdge && !current.some(index => squares[currentPosition + index + 1].classList.contains('taken'))) {
                currentPosition += 1;
            }
            draw();
        }

        // 7. íšŒì „ (Rotate) - ê°„ë‹¨í•œ êµ¬í˜„ì„ ìœ„í•´ I-ë¸”ë¡ë§Œ íšŒì „ ì½”ë“œë¥¼ ì‘ì„±í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. T, L, J ë“±ì€ ë³„ë„ì˜ íšŒì „ ë°°ì—´ì´ í•„ìš”í•©ë‹ˆë‹¤.
        function rotate() {
            // ì´ ì˜ˆì‹œì—ì„œëŠ” ë‹¨ìˆœí™”í•˜ì—¬ I, O ë¸”ë¡ë§Œ ì œì™¸í•˜ê³  íšŒì „í•˜ëŠ” ëŒ€ì‹ ,
            // ë°°ì—´ ë³€í™˜ ë¡œì§ì´ ë³µì¡í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ ê±´ë„ˆëœë‹ˆë‹¤.
            // ì‹¤ì œ êµ¬í˜„ ì‹œì—ëŠ” ë¸”ë¡ í˜•íƒœì˜ 4ê°€ì§€ íšŒì „ ë°°ì—´ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
            draw();
        }

        // 8. ì¤„ ì œê±° ë° ì ìˆ˜ ì¶”ê°€
        function addScore() {
            for (let i = 0; i < BOARD_WIDTH * BOARD_HEIGHT; i += BOARD_WIDTH) {
                const row = [];
                for (let j = 0; j < BOARD_WIDTH; j++) {
                    row.push(i + j);
                }
                
                // ì¤„ì´ ê½‰ ì°¼ëŠ”ì§€ í™•ì¸
                if (row.every(index => squares[index].classList.contains('taken'))) {
                    score += 10;
                    scoreDisplay.innerHTML = score;
                    
                    // ê½‰ ì°¬ ì¤„ ì œê±°
                    row.forEach(index => {
                        squares[index].classList.remove('taken', 'block', `color-${squares[index].className.match(/color-\d/)[0].slice(-1)}`);
                    });
                    
                    // ìœ—ì¤„ë“¤ì„ ì•„ë˜ë¡œ ì´ë™
                    const squaresRemoved = squares.splice(i, BOARD_WIDTH);
                    squares = squaresRemoved.concat(squares);
                    squares.forEach(cell => gameBoard.appendChild(cell));
                }
            }
        }

        // 9. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (PC í‚¤ë³´ë“œ)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') move('left');
            else if (e.key === 'ArrowRight') move('right');
            else if (e.key === 'ArrowDown') moveDown();
            else if (e.key === 'ArrowUp') rotate();
        });

        // 10. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ëª¨ë°”ì¼ í„°ì¹˜) - touchstart ì‚¬ìš©
        document.getElementById('left-btn').addEventListener('touchstart', (e) => { e.preventDefault(); move('left'); });
        document.getElementById('right-btn').addEventListener('touchstart', (e) => { e.preventDefault(); move('right'); });
        document.getElementById('rotate-btn').addEventListener('touchstart', (e) => { e.preventDefault(); rotate(); });
        document.getElementById('down-btn').addEventListener('touchstart', (e) => { e.preventDefault(); moveDown(); });

        // 11. ê²Œì„ ì‹œì‘
        createBoard();
        timerId = setInterval(moveDown, 1000); // 1ì´ˆë§ˆë‹¤ ë¸”ë¡ í•˜ê°•
        /* ---------------- JavaScript ë ---------------- */
    </script>
</body>
</html>
