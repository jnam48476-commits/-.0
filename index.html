<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All-in-One Mobile Tetris (Fixed)</title>
    <style>
        /* ---------------- CSS ì‹œì‘ ---------------- */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Arial', sans-serif;
            background-color: #333;
            color: #fff;
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }

        #game-container {
            display: flex;
            flex-direction: column; 
            align-items: center;
            width: 95%; 
            max-width: 400px;
            padding: 10px;
            background-color: #222;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #game-board {
            display: grid;
            grid-template-columns: repeat(10, 1fr); 
            width: 100%;
            border: 4px solid #fff;
            background-color: #000;
            aspect-ratio: 10 / 20; 
        }

        .square {
            min-height: 1.5vw; 
            box-sizing: border-box;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .block {
            border: 1px solid #111;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        /* ë¸”ë¡ ìƒ‰ìƒ ì •ì˜ */
        .color-0 { background-color: cyan; } /* I */
        .color-1 { background-color: blue; } /* J */
        .color-2 { background-color: orange; } /* L */
        .color-3 { background-color: yellow; } /* O */
        .color-4 { background-color: lime; } /* S */
        .color-5 { background-color: purple; } /* T */
        .color-6 { background-color: red; } /* Z */

        #info-panel {
            width: 100%;
            text-align: center;
            margin: 10px 0;
        }

        /* ëª¨ë°”ì¼ ì¡°ì‘ ë²„íŠ¼ */
        #mobile-controls {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 20px;
        }

        #mobile-controls button {
            padding: 15px 20px;
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.1s;
            touch-action: manipulation;
        }

        #mobile-controls button:active {
            background-color: #0056b3;
        }
        /* ---------------- CSS ë ---------------- */
    </style>
</head>
<body>
    <div id="game-container">
        <div id="info-panel">
            <h2>í…ŒíŠ¸ë¦¬ìŠ¤</h2>
            <p>ì ìˆ˜: <span id="score">0</span></p>
        </div>

        <div id="game-board">
            </div>
        
        <div id="mobile-controls">
            <button id="left-btn">â—€ Left</button>
            <button id="rotate-btn">ğŸ”„ Rotate</button>
            <button id="right-btn">â–¶ Right</button>
            <button id="down-btn">â¬‡ Down</button>
        </div>
        <p style="font-size: 0.8em; margin-top: 10px;">(PC: â†â†’â†‘â†“, ëª¨ë°”ì¼: ë²„íŠ¼ ì‚¬ìš©)</p>
    </div>

    <script>
        /* ---------------- JavaScript ì‹œì‘ ---------------- */
        const BOARD_WIDTH = 10;
        const BOARD_HEIGHT = 20;
        const gameBoard = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score');
        
        let squares = [];
        let score = 0;
        let timerId;
        
        // 7ê°€ì§€ í…ŒíŠ¸ë¡œë¯¸ë…¸ ëª¨ì–‘ ì •ì˜
        const theTetrominoes = [
            [[1, BOARD_WIDTH + 1, BOARD_WIDTH * 2 + 1, BOARD_WIDTH * 3 + 1], 0], // I
            [[0, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH * 2 + 1], 1],         // J
            [[2, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH * 2 + 1], 2],         // L
            [[0, 1, BOARD_WIDTH, BOARD_WIDTH + 1], 3],                           // O
            [[1, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH * 2], 4],             // S
            [[1, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH + 2], 5],             // T
            [[0, BOARD_WIDTH, BOARD_WIDTH + 1, BOARD_WIDTH * 2 + 2], 6]          // Z
        ];
        
        let currentRotation = 0;
        let random = Math.floor(Math.random() * theTetrominoes.length);
        let currentPieceData = theTetrominoes[random];
        let current = currentPieceData[0];
        let currentColor = currentPieceData[1];
        let currentPosition = 4;

        // 1. ê²Œì„ ë³´ë“œ ìƒì„± (200ê°œì˜ div)
        function createBoard() {
            for (let i = 0; i < BOARD_WIDTH * BOARD_HEIGHT; i++) {
                const square = document.createElement('div');
                square.classList.add('square');
                gameBoard.appendChild(square);
                squares.push(square);
            }
            // ğŸ›‘ ìˆ˜ì •ëœ ë¶€ë¶„: ë°”ë‹¥ ì¶©ëŒ ê°ì§€ìš© ë”ë¯¸ ì¹¸ì„ squares ë°°ì—´ì—ë§Œ ì¶”ê°€ (DOMì— ì¶”ê°€í•˜ì§€ ì•ŠìŒ)
            for (let i = 0; i < BOARD_WIDTH; i++) {
                const dummySquare = document.createElement('div');
                dummySquare.classList.add('taken'); 
                squares.push(dummySquare);
            }
        }
        
        // 2. ë¸”ë¡ ê·¸ë¦¬ê¸°
        function draw() {
            current.forEach(index => {
                // ì•ˆì „ì„± í™•ì¸: ì¸ë±ìŠ¤ê°€ ë°°ì—´ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡
                if (squares[currentPosition + index]) { 
                    squares[currentPosition + index].classList.add('block', `color-${currentColor}`);
                }
            });
        }
        
        // 3. ë¸”ë¡ ì§€ìš°ê¸°
        function undraw() {
            current.forEach(index => {
                if (squares[currentPosition + index]) {
                    squares[currentPosition + index].classList.remove('block', `color-${currentColor}`);
                }
            });
        }

        // 4. ë¸”ë¡ í•˜ê°• ë° ì¶©ëŒ ê°ì§€
        function moveDown() {
            undraw();
            if (!isAtBottom()) {
                currentPosition += BOARD_WIDTH;
            } else {
                freeze();
                return;
            }
            draw();
        }

        // ë°”ë‹¥ ë˜ëŠ” ë‹¤ë¥¸ ë¸”ë¡ê³¼ ì¶©ëŒ ê°ì§€
        function isAtBottom() {
            // í˜„ì¬ ìœ„ì¹˜ì—ì„œ ë‹¤ìŒ ì¹¸(BOARD_WIDTH ì•„ë˜)ì— 'taken' í´ë˜ìŠ¤ê°€ ìˆëŠ”ì§€ í™•ì¸
            // squares[currentPosition + index + BOARD_WIDTH]ê°€ ë°”ë‹¥ ë”ë¯¸ ì¹¸ì„ ê°€ë¦¬í‚¤ë©´ ì¶©ëŒ
            return current.some(index => squares[currentPosition + index + BOARD_WIDTH]?.classList.contains('taken'));
        }

        // 5. ë¸”ë¡ ê³ ì • (Freeze)
        function freeze() {
            current.forEach(index => squares[currentPosition + index].classList.add('taken'));
            
            addScore();
            
            // ìƒˆ ë¸”ë¡ ìƒì„±
            random = Math.floor(Math.random() * theTetrominoes.length);
            currentPieceData = theTetrominoes[random];
            current = currentPieceData[0];
            currentColor = currentPieceData[1];
            currentPosition = 4;
            draw();

            // ê²Œì„ ì˜¤ë²„ í™•ì¸
            if (current.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                scoreDisplay.innerHTML = 'Game Over! (Score: ' + score + ')';
                clearInterval(timerId);
            }
        }

        // 6. ì´ë™ (ì¢Œ/ìš°)
        function move(direction) {
            undraw();
            
            const isAtLeftEdge = current.some(index => (currentPosition + index) % BOARD_WIDTH === 0);
            const isAtRightEdge = current.some(index => (currentPosition + index) % BOARD_WIDTH === BOARD_WIDTH - 1);
            
            let newPosition = currentPosition;
            
            if (direction === 'left') {
                if (!isAtLeftEdge) newPosition -= 1;
            } else if (direction === 'right') {
                if (!isAtRightEdge) newPosition += 1;
            }

            // ìƒˆë¡œìš´ ìœ„ì¹˜ì— 'taken' ë¸”ë¡ì´ ìˆëŠ”ì§€ í™•ì¸ (ì¶©ëŒ ë°©ì§€)
            if (!current.some(index => squares[newPosition + index]?.classList.contains('taken'))) {
                currentPosition = newPosition;
            }
            
            draw();
        }

        // 7. íšŒì „ (Rotate) - ë‹¨ìˆœí™”ëœ ì½”ë“œ (ê¸°ëŠ¥ì ìœ¼ë¡œ ì™„ë²½í•˜ì§€ ì•ŠìŒ)
        function rotate() {
            // ì‹¤ì œ êµ¬í˜„ ì‹œì—ëŠ” íšŒì „ ë°°ì—´ê³¼ ì¶©ëŒ ê²€ì‚¬ ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.
            undraw();
            currentRotation = (currentRotation + 1) % 4;
            draw();
        }

        // 8. ì¤„ ì œê±° ë° ì ìˆ˜ ì¶”ê°€
        function addScore() {
            for (let i = 0; i < BOARD_WIDTH * BOARD_HEIGHT; i += BOARD_WIDTH) {
                const row = [];
                for (let j = 0; j < BOARD_WIDTH; j++) {
                    row.push(i + j);
                }
                
                if (row.every(index => squares[index].classList.contains('taken'))) {
                    score += 10;
                    scoreDisplay.innerHTML = score;
                    
                    // ê½‰ ì°¬ ì¤„ ì œê±° (ì‹œê°ì  + ë°ì´í„°)
                    row.forEach(index => {
                        // color í´ë˜ìŠ¤ ì¶”ì¶œ ì‹œ ì˜¤ë¥˜ ë°©ì§€ë¥¼ ìœ„í•´ ì˜µì…”ë„ ì²´ì´ë‹ ì‚¬ìš©
                        squares[index].classList.remove('taken', 'block', `color-${squares[index].className.match(/color-\d/)?.[0]?.slice(-1) || ''}`);
                    });
                    
                    // ìœ—ì¤„ë“¤ì„ ì•„ë˜ë¡œ ì´ë™
                    const squaresRemoved = squares.splice(i, BOARD_WIDTH);
                    squares = squaresRemoved.concat(squares);
                    
                    // HTML DOM ì—…ë°ì´íŠ¸
                    squares.slice(0, BOARD_WIDTH * BOARD_HEIGHT).forEach(cell => gameBoard.appendChild(cell));
                }
            }
        }

        // 9. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (PC í‚¤ë³´ë“œ)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') move('left');
            else if (e.key === 'ArrowRight') move('right');
            else if (e.key === 'ArrowDown') moveDown();
            else if (e.key === 'ArrowUp') rotate();
        });

        // 10. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ëª¨ë°”ì¼ í„°ì¹˜)
        document.getElementById('left-btn').addEventListener('touchstart', (e) => { e.preventDefault(); move('left'); });
        document.getElementById('right-btn').addEventListener('touchstart', (e) => { e.preventDefault(); move('right'); });
        document.getElementById('rotate-btn').addEventListener('touchstart', (e) => { e.preventDefault(); rotate(); });
        document.getElementById('down-btn').addEventListener('touchstart', (e) => { e.preventDefault(); moveDown(); });

        // 11. ê²Œì„ ì‹œì‘
        createBoard();
        // 1ì´ˆë§ˆë‹¤ moveDown ì‹¤í–‰ (ë¸”ë¡ í•˜ê°•)
        timerId = setInterval(moveDown, 1000); 
        /* ---------------- JavaScript ë ---------------- */
    </script>
</body>
</html>
